---
title: "rgbif"
author: "LH"
date: "2023-11-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Packages
```{r}
library(here)
library(rgbif)
library(sf)
```

Process bounding box for SMF

top left:
 lat: 34.465504째
 long: -119.771787째
 
bottom right: 
  lat:  34.454424째
  long: -119.750857째
  
c(lng_min, lat_min, lng_max, lat_max)
st_bbox(xmin, ymin, xmax and ymax)
c(-119.750857, 34.454424, 119.771787, 34.465504)

For converting shp to wkt:
https://www.erikkusch.com/courses/gbif/datadiscovery/

Test your WKT object here: http://arthur-e.github.io/Wicket/sandbox-gmaps3.html
(Print your wkt object n)

```{r}
SMF_wkt <- gbif_bbox2wkt(minx = -119.750857, miny = 34.454424, maxx = -119.771787, maxy = 34.465504)
# SMF_wkt # print this, open the sand box link, copy the results into the box, then press Map It!
```

Import GBIF data for R
```{r}
# download GBIF occurrence data for this species; this takes time if there are many data points!
gbif_data <- occ_data(hasCoordinate = TRUE, geometry = SMF_wkt, year = "1990, 2023", limit = 3500)

# take a look at the downloaded data:
gbif_data

# if "Records found" is larger than "Records returned", you need to increase the 'limit' argument above -- see help(occ_data) for options and limitations
# as of 2023-02-18, there are 2-3k records for this species in our region

# get the DOIs for citing these data properly
citation <- gbif_citation(gbif_data)

# get the columns that matter for mapping and cleaning the occurrence data
myspecies_coords <- gbif_data$data[ , c("decimalLongitude", "decimalLatitude", "occurrenceStatus", "eventDate", "coordinateUncertaintyInMeters", "institutionCode", "references")]
#head(myspecies_coords)

# map the occurrence data
map("world", xlim = range(myspecies_coords$decimalLongitude), ylim = range(myspecies_coords$decimalLatitude))  # if the map doesn't appear right at first, run this command again
points(myspecies_coords[ , c("decimalLongitude", "decimalLatitude")], pch = ".")
```

